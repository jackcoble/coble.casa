---
- name: Ensure all packages are up to date
  ansible.builtin.dnf:
    name: "*"
    state: latest
  become: true

- name: Install basic utilities
  ansible.builtin.dnf:
    name:
      - git
      - curl
      - vim
      - unzip
      - wget
      - kernel-modules-extra
      - nfs-utils
    state: present
  become: true

- name: Reboot server to apply extra kernel modules
  ansible.builtin.reboot:
    msg: "Rebooting to load extra kernel modules"
    reboot_timeout: 300

- name: Ensure firewalld is installed
  ansible.builtin.dnf:
    name: firewalld
    state: present
  become: true

- name: Enable and start firewalld
  ansible.builtin.service:
    name: firewalld
    state: started
    enabled: true

- name: Allow SSH through firewall
  ansible.posix.firewalld:
    service: ssh
    permanent: true
    state: enabled
    immediate: true
